(self["webpackChunkvue_start_1"]=self["webpackChunkvue_start_1"]||[]).push([[6552],{26552:function(t,n,r){"use strict";r.r(n),r.d(n,{default:function(){return f}});var e=function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",[e("raw-loader",{attrs:{mytxt:r(54820).Z}}),e("h1",[t._v("This is KonvaVue")]),e("b-row",[e("b-col",{staticClass:"border-right",attrs:{sm:"3"}},[e("div",{staticClass:"mb-1"},[e("button",{staticClass:"mr-1",attrs:{disabled:1!=t.Sel.length},on:{click:t.onDel}},[t._v("Del")]),e("button",{staticClass:"mr-1",attrs:{disabled:2!=t.Sel.length},on:{click:t.onLink}},[t._v(t._s(t.unLink?"UnLink":"Link"))]),e("button",{staticClass:"mr-1",on:{click:t.onReset}},[t._v("Reset")]),e("button",{staticClass:"mr-1",on:{click:t.onLoad}},[t._v("Load")]),e("button",{staticClass:"mr-1",on:{click:t.onSave}},[t._v("Save")])]),e("div",{attrs:{id:"stage-parent"}},[e("div",{staticClass:"border",attrs:{id:"container"}},[e("v-stage",{ref:"stage",attrs:{config:t.configKonva},on:{click:t.onStageClick,mousemove:t.onStageMouseMove}},[e("v-layer",{ref:"layer"},[e("v-circle",{attrs:{config:t.configCircle}}),e("v-rect",{ref:"rect",attrs:{config:{x:100,y:100,width:150,height:150,fill:"yellow",stroke:"blue",strokeWidth:5,draggable:!0,visible:!1}}}),e("v-line",{ref:"line",attrs:{config:{points:[100,100,400,200],stroke:"gray",strokeWidth:5,lineCap:"round",lineJoin:"round",draggable:!0,visible:!1}}}),e("v-shape",{ref:"nice",attrs:{config:{sceneFunc:function(t,n){var r=-20,e=-50;t.beginPath(),t.moveTo(r+20,e+50),t.lineTo(r+220,e+80),t.quadraticCurveTo(r+150,e+100,r+260,e+170),t.closePath(),t.fillStrokeShape(n)},fill:"#00D2FF",stroke:"black",strokeWidth:4,visible:!0,draggable:!0,visible:!1}}}),e("v-shape",{ref:"ball",attrs:{config:{x:150,y:150,r:90,text:"1",fontSize:50,fill:"aqua",stroke:"black",textcolor:"red",strokeWidth:5,draggable:!0,sel:!1,visible:!1,sceneFunc:function(t,n){var r=n.getAttr("fontSize");t.beginPath(),t.arc(0,0,n.getAttr("r"),0,2*Math.PI),t.fillStrokeShape(n);var e=n.getAttr("textcolor");t.fillStyle=e,t.textBaseline="middle",t.textAlign="center",t.font=r+"px verdana",t.fillText(""+n.getAttr("text"),0,0)}}}}),e("v-shape",{ref:"board",attrs:{config:{x:50,y:50,width:300,height:100,text:"Thá»©c 101",fontSize:60,fill:"yellow",stroke:"red",strokeWidth:1,draggable:!0,visible:!1,sceneFunc:function(t,n){var r=n.getAttr("fontSize");t.beginPath(),t.rect(0,0,n.getAttr("width"),n.getAttr("height")),t.fillStrokeShape(n),t.fillStyle="red",t.textBaseline="middle",t.textAlign="center",t.font=r+"px Times New Roman",t.fillText(""+n.getAttr("text"),n.getAttr("width")/2,n.getAttr("height")/2)}}}})],1)],1)],1)])]),e("b-col",{attrs:{sm:"9"}},[t._v(" "+t._s(t.msg)+t._s(t.hover)+" "),e("div",{staticClass:"row no-gutters border-top p-1"},t._l(t.listData,(function(n,r){return e("div",{key:r,staticClass:"mb-1 mr-1 col-sm-2"},[e("div",{class:r==t.hover?"border border-primary":"",staticStyle:{position:"relative"},on:{mouseover:function(n){t.hover=r},mouseout:function(n){t.hover=-1}}},[e("img",{staticClass:"img-thumbnail",attrs:{src:n.src},on:{click:function(r){return t.onView(n.data)}}}),e("button",{staticClass:"m-1",staticStyle:{position:"absolute",bottom:"0",right:"0"},on:{click:function(n){return t.onDelData(r)}}},[t._v("Del")])])])})),0)])],1)],1)},i=[],a=(r(40561),r(38862),r(41539),r(54747),r(39714),r(69826),r(26699),r(32023),r(34553),r(68309),r(43290),1500),l=1e3,o=null,s=null,c={name:"Tpl",components:{},computed:{test:function(){return"hello"}},data:function(){return{msg:"hello",configKonva:{width:a,height:l},configCircle:{x:a/2,y:l/2,radius:90,fill:"yellow",stroke:"black",strokeWidth:5,draggable:!0,visible:!1},count:0,p:{},arPoint:[],Sel:[],arSel:[],unLink:!1,listData:[],hover:-1}},mounted:function(){this.$nextTick((function(){s=this.$refs.layer.getNode(),o=this.$refs.stage.getNode(),window.addEventListener("resize",this.fitStageIntoParentContainer),this.fitStageIntoParentContainer()}))},created:function(){},methods:{onDelData:function(t){this.listData.splice(t,1)},onView:function(t){this.load(JSON.parse(JSON.stringify(t)))},onSave:function(){var t=o.toDataURL(),n={arPoint:this.arPoint,arSel:this.arSel,count:this.count};this.listData.push({src:t,data:JSON.parse(JSON.stringify(n))})},load:function(t){var n=this;this.reset(),this.count=t.count,this.arPoint=t.arPoint,this.arSel=t.arSel,this.arPoint.forEach((function(t,r){var e=n.createBall(t.x,t.y,60,"myball",t.id.toString());s.add(e)})),this.arSel.forEach((function(t,r){var e=n.createLine("myline");s.add(e)})),this.draw()},onLoad:function(){var t={arPoint:[{id:0,x:577,y:129},{id:1,x:452,y:273},{id:2,x:721,y:304},{id:3,x:352,y:498},{id:4,x:552,y:516}],arSel:[[0,1],[0,2],[1,3],[1,4]],count:5};this.load(t)},reset:function(){this.count=0,this.arPoint.forEach((function(t,n){s.find(".myball")[0].destroy()})),this.arPoint=[],this.arSel.forEach((function(t,n){s.find(".myline")[0].destroy()})),this.arSel=[]},onReset:function(){this.reset(),this.draw()},onDel:function(){var t=this.Sel[0],n=[],r=[];this.arSel.forEach((function(e,i){e.includes(t)?n.push(e):r.push(e)})),n.forEach((function(t,n){s.find(".myline")[0].destroy()})),this.arSel=r,s.find("#".concat(t))[0].destroy();var e=this.arPoint.findIndex((function(n){return n.id==t}));this.arPoint.splice(e,1),this.draw()},onUnlink:function(t,n){var r=!1,e=[];this.arSel.forEach((function(i,a){i.includes(t)&&i.includes(n)?r=!0:e.push(i)})),1==r&&s.find(".myline")[0].destroy(),this.arSel=e,this.unLink=!1,this.draw()},chkPairExist:function(t,n){var r=!1;return this.arSel.forEach((function(e,i){e.includes(t)&&e.includes(n)&&(r=!0)})),r},onLink:function(){var t=this,n=this.Sel[0],r=this.Sel[1],e=this.chkPairExist(n,r);if(1!=e){this.arSel.push(this.Sel);var i=this.createLine("myline");s.add(i),this.drawLine();var a=s.find(".myball");a.forEach((function(n,r){t.drawBall(n)})),this.Sel=this.getSel(),this.draw()}else this.onUnlink(n,r)},drawLine:function(){var t=this,n=s.find(".myline");n.forEach((function(n,r){var e=t.arSel[r][0],i=t.arSel[r][1],a=s.find("#".concat(e))[0],l=s.find("#".concat(i))[0],o={x:a.x(),y:a.y()},c={x:l.x(),y:l.y()};n.points([o.x,o.y,c.x,c.y]),n.moveToBottom()}))},draw:function(){this.drawLine(),this.msg={arPoint:this.arPoint,arSel:this.arSel,count:this.count}},createLine:function(t){var n=this.$refs.line.getNode().clone();return n.visible(!0),n.name(t),n},drawBall:function(t){var n,r,e=t.fill();"blue"==e&&(n="yellow",r="red",t.fill(n),t.setAttr("textcolor",r))},createBall:function(t,n,r,e,i){var a=this,l=this.$refs.ball.getNode().clone();return l.visible(!0),l.x(t),l.y(n),l.setAttr("r",r),l.fill("yellow"),l.stroke("black"),l.name(e),l.id(i),l.setAttr("text",i),l.on("click",(function(t){var n,r,e=t.target.fill();if("blue"==e?(n="yellow",r="red"):(n="blue",r="white"),t.target.fill(n),t.target.setAttr("textcolor",r),a.Sel=a.getSel(),a.unLink=!1,2==a.Sel.length){var i=a.Sel[0],l=a.Sel[1];1==a.chkPairExist(i,l)&&(a.unLink=!0)}a.draw()})),l.on("dragend",(function(t){})),l.on("dragmove",(function(t){var n={id:t.target.id(),x:Math.floor(t.target.x()),y:Math.floor(t.target.y())};a.p=n;var r=a.arPoint.findIndex((function(t){return t.id==n.id}));a.arPoint[r]=n,a.draw()})),l},getSel:function(){var t=[],n=s.find(".myball");return n.forEach((function(n,r){"blue"==n.fill()&&t.push(parseInt(n.id()))})),t},onStageClick:function(t){var n=t.target.name();if("myball"!=n){var r=this.myGetMouse(),e=this.createBall(r.x,r.y,60,"myball",this.count.toString());this.arPoint.push({id:this.count,x:r.x,y:r.y}),this.count++,s.add(e),this.draw()}},onStageMouseMove:function(t){},getListRect:function(){return s.find(".myrect")},getListLine:function(){return s.find(".myline")},getListBall:function(){return s.find(".myball")},myGetMouse:function(){var t=o.scale().x,n=o.getPointerPosition(),r=n.x,e=n.y,i=Math.round(r/t),a=Math.round(e/t);return{x:i,y:a}},fitStageIntoParentContainer:function(){var t=document.querySelector("#stage-parent"),n=t.offsetWidth,r=n/a;o.width(a*r),o.height(l*r),o.scale({x:r,y:r}),this.configKonva.width=a*r,this.configKonva.height=l*r}}},d=c,h=r(1001),u=(0,h.Z)(d,e,i,!1,null,"a1f9b218",null),f=u.exports},21285:function(t,n,r){"use strict";var e=r(47908),i=r(51400),a=r(26244);t.exports=function(t){var n=e(this),r=a(n),l=arguments.length,o=i(l>1?arguments[1]:void 0,r),s=l>2?arguments[2]:void 0,c=void 0===s?r:i(s,r);while(c>o)n[o++]=t;return n}},18533:function(t,n,r){"use strict";var e=r(42092).forEach,i=r(9341),a=i("forEach");t.exports=a?[].forEach:function(t){return e(this,t,arguments.length>1?arguments[1]:void 0)}},9341:function(t,n,r){"use strict";var e=r(47293);t.exports=function(t,n){var r=[][t];return!!r&&e((function(){r.call(null,n||function(){return 1},1)}))}},84964:function(t,n,r){var e=r(5112),i=e("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[i]=!1,"/./"[t](n)}catch(e){}}return!1}},86135:function(t,n,r){"use strict";var e=r(34948),i=r(3070),a=r(79114);t.exports=function(t,n,r){var l=e(n);l in t?i.f(t,l,a(0,r)):t[l]=r}},47850:function(t,n,r){var e=r(70111),i=r(84326),a=r(5112),l=a("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[l])?!!n:"RegExp"==i(t))}},3929:function(t,n,r){var e=r(17854),i=r(47850),a=e.TypeError;t.exports=function(t){if(i(t))throw a("The method doesn't accept regular expressions");return t}},67066:function(t,n,r){"use strict";var e=r(19670);t.exports=function(){var t=e(this),n="";return t.hasIndices&&(n+="d"),t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.dotAll&&(n+="s"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},34706:function(t,n,r){var e=r(46916),i=r(92597),a=r(47976),l=r(67066),o=RegExp.prototype;t.exports=function(t){var n=t.flags;return void 0!==n||"flags"in o||i(t,"flags")||!a(o,t)?n:e(l,t)}},43290:function(t,n,r){var e=r(82109),i=r(21285),a=r(51223);e({target:"Array",proto:!0},{fill:i}),a("fill")},34553:function(t,n,r){"use strict";var e=r(82109),i=r(42092).findIndex,a=r(51223),l="findIndex",o=!0;l in[]&&Array(1)[l]((function(){o=!1})),e({target:"Array",proto:!0,forced:o},{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),a(l)},69826:function(t,n,r){"use strict";var e=r(82109),i=r(42092).find,a=r(51223),l="find",o=!0;l in[]&&Array(1)[l]((function(){o=!1})),e({target:"Array",proto:!0,forced:o},{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),a(l)},26699:function(t,n,r){"use strict";var e=r(82109),i=r(41318).includes,a=r(47293),l=r(51223),o=a((function(){return!Array(1).includes()}));e({target:"Array",proto:!0,forced:o},{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),l("includes")},40561:function(t,n,r){"use strict";var e=r(82109),i=r(17854),a=r(51400),l=r(19303),o=r(26244),s=r(47908),c=r(65417),d=r(86135),h=r(81194),u=h("splice"),f=i.TypeError,g=Math.max,v=Math.min,x=9007199254740991,y="Maximum allowed length exceeded";e({target:"Array",proto:!0,forced:!u},{splice:function(t,n){var r,e,i,h,u,p,b=s(this),m=o(b),S=a(t,m),k=arguments.length;if(0===k?r=e=0:1===k?(r=0,e=m-S):(r=k-2,e=v(g(l(n),0),m-S)),m+r-e>x)throw f(y);for(i=c(b,e),h=0;h<e;h++)u=S+h,u in b&&d(i,h,b[u]);if(i.length=e,r<e){for(h=S;h<m-e;h++)u=h+e,p=h+r,u in b?b[p]=b[u]:delete b[p];for(h=m;h>m-e+r;h--)delete b[h-1]}else if(r>e)for(h=m-e;h>S;h--)u=h+e-1,p=h+r-1,u in b?b[p]=b[u]:delete b[p];for(h=0;h<r;h++)b[h+S]=arguments[h+2];return b.length=m-e+r,i}})},38862:function(t,n,r){var e=r(82109),i=r(35005),a=r(22104),l=r(46916),o=r(1702),s=r(47293),c=r(43157),d=r(60614),h=r(70111),u=r(52190),f=r(50206),g=r(30133),v=i("JSON","stringify"),x=o(/./.exec),y=o("".charAt),p=o("".charCodeAt),b=o("".replace),m=o(1..toString),S=/[\uD800-\uDFFF]/g,k=/^[\uD800-\uDBFF]$/,w=/^[\uDC00-\uDFFF]$/,P=!g||s((function(){var t=i("Symbol")();return"[null]"!=v([t])||"{}"!=v({a:t})||"{}"!=v(Object(t))})),L=s((function(){return'"\\udf06\\ud834"'!==v("\udf06\ud834")||'"\\udead"'!==v("\udead")})),A=function(t,n){var r=f(arguments),e=n;if((h(n)||void 0!==t)&&!u(t))return c(n)||(n=function(t,n){if(d(e)&&(n=l(e,this,t,n)),!u(n))return n}),r[1]=n,a(v,null,r)},E=function(t,n,r){var e=y(r,n-1),i=y(r,n+1);return x(k,t)&&!x(w,i)||x(w,t)&&!x(k,e)?"\\u"+m(p(t,0),16):t};v&&e({target:"JSON",stat:!0,arity:3,forced:P||L},{stringify:function(t,n,r){var e=f(arguments),i=a(P?A:v,null,e);return L&&"string"==typeof i?b(i,S,E):i}})},39714:function(t,n,r){"use strict";var e=r(76530).PROPER,i=r(98052),a=r(19670),l=r(41340),o=r(47293),s=r(34706),c="toString",d=RegExp.prototype,h=d[c],u=o((function(){return"/a/b"!=h.call({source:"a",flags:"b"})})),f=e&&h.name!=c;(u||f)&&i(RegExp.prototype,c,(function(){var t=a(this),n=l(t.source),r=l(s(t));return"/"+n+"/"+r}),{unsafe:!0})},32023:function(t,n,r){"use strict";var e=r(82109),i=r(1702),a=r(3929),l=r(84488),o=r(41340),s=r(84964),c=i("".indexOf);e({target:"String",proto:!0,forced:!s("includes")},{includes:function(t){return!!~c(o(l(this)),o(a(t)),arguments.length>1?arguments[1]:void 0)}})},54747:function(t,n,r){var e=r(17854),i=r(48324),a=r(98509),l=r(18533),o=r(68880),s=function(t){if(t&&t.forEach!==l)try{o(t,"forEach",l)}catch(n){t.forEach=l}};for(var c in i)i[c]&&s(e[c]&&e[c].prototype);s(a)},54820:function(t,n){"use strict";n["Z"]='<template>\r\n  <div>\r\n    <raw-loader :mytxt=" require(\'!raw-loader!./KonvaVueDoThi.vue\').default "></raw-loader> \r\n    <h1>This is KonvaVue</h1>\r\n    <b-row>\r\n      <b-col sm="3" class="border-right">\r\n        <div class="mb-1">\r\n          <button class="mr-1" @click="onDel" :disabled=" (Sel.length==1) ? false : true " >Del</button>\r\n          <button class="mr-1" @click="onLink" :disabled=" (Sel.length==2) ? false : true " >{{(!unLink) ? \'Link\' : \'UnLink\'}}</button>\r\n          <button class="mr-1" @click="onReset" >Reset</button>\r\n          <button class="mr-1" @click="onLoad" >Load</button>\r\n          <button class="mr-1" @click="onSave" >Save</button>\r\n        </div>\r\n          \r\n          <div id="stage-parent">\r\n            <div id="container" class="border">\r\n                <v-stage ref="stage"\r\n                    @click="onStageClick"\r\n                    @mousemove="onStageMouseMove" \r\n                    :config="configKonva" >\r\n                    <v-layer ref="layer">\r\n                        <v-circle :config="configCircle"></v-circle>\r\n                        <v-rect ref="rect" \r\n                            :config="{\r\n                                x: 100,\r\n                                y: 100,\r\n                                width: 150,\r\n                                height: 150,\r\n                                fill: \'yellow\',\r\n                                stroke:\'blue\',\r\n                                strokeWidth:5,\r\n                                //shadowBlur: 10,\r\n                                draggable:true,\r\n                                visible:false\r\n                            }"\r\n                        />\r\n                        <v-line ref="line" :config="{\r\n                          points: [100,100,400,200],\r\n                          stroke: \'gray\',\r\n                          strokeWidth: 5,\r\n                          lineCap: \'round\',\r\n                          lineJoin: \'round\',\r\n                          draggable:true,\r\n                          visible: false\r\n                        }"></v-line>\r\n                        <v-shape ref="nice"\r\n                          :config="{\r\n                            sceneFunc: function(context, shape) {\r\n                              let x=-20;\r\n                              let y=-50;\r\n                              context.beginPath();\r\n                              context.moveTo(x+20, y+50);\r\n                              context.lineTo(x+220, y+80);\r\n                              context.quadraticCurveTo(x+150, y+100, x+260, y+170);\r\n                              context.closePath();\r\n                              context.fillStrokeShape(shape);\r\n                            },\r\n                            fill: \'#00D2FF\',\r\n                            stroke: \'black\',\r\n                            strokeWidth: 4,\r\n                            visible: true,\r\n                            draggable:true,\r\n                            visible:false,\r\n                          }"\r\n                        />\r\n                        <v-shape ref="ball"\r\n                          :config="{\r\n                            x:150,\r\n                            y:150,\r\n                            r:90,\r\n                            text:\'1\',\r\n                            fontSize:50,\r\n                            fill: \'aqua\',\r\n                            stroke: \'black\',\r\n                            textcolor:\'red\',\r\n                            strokeWidth: 5,\r\n                            draggable:true,  \r\n                            sel:false,      \r\n                            visible:false,\r\n                            sceneFunc: function (context, shape) {\r\n                              let fontSize=shape.getAttr(\'fontSize\');//40;\r\n                              context.beginPath();\r\n                              context.arc(0, 0, shape.getAttr(\'r\'), 0, 2 * Math.PI);\r\n                              context.fillStrokeShape(shape);\r\n                              let textcolor=shape.getAttr(\'textcolor\');\r\n                              context.fillStyle=textcolor;//\'white\';\r\n                              context.textBaseline = \'middle\'; \r\n                              context.textAlign = \'center\';\r\n                              context.font=`${fontSize}px verdana`;//verdana//Times New Roman\r\n                              context.fillText(`${shape.getAttr(\'text\')}`, 0,0);\r\n\r\n                            }\r\n                          }"\r\n                        />\r\n                        <v-shape ref="board" :config="{\r\n                          x:50,\r\n                          y:50,\r\n                          width:300,\r\n                          height:100,\r\n                          text:\'Thá»©c 101\',\r\n                          fontSize:60,\r\n                          fill: \'yellow\',\r\n                          stroke: \'red\',\r\n                          strokeWidth: 1,\r\n                          draggable:true, \r\n                          visible:false,       \r\n                          sceneFunc: function (context, shape) {\r\n                            let fontSize=shape.getAttr(\'fontSize\');\r\n                            context.beginPath();\r\n                            context.rect(0, 0, shape.getAttr(\'width\'), shape.getAttr(\'height\'));\r\n                            context.fillStrokeShape(shape);\r\n                            context.fillStyle=\'red\';\r\n                            context.textBaseline = \'middle\'; \r\n                            context.textAlign = \'center\';\r\n                            context.font=`${fontSize}px Times New Roman`;\r\n                            context.fillText(`${shape.getAttr(\'text\')}`, shape.getAttr(\'width\')/2,shape.getAttr(\'height\')/2);\r\n                          }\r\n                        }">\r\n                        </v-shape>\r\n                    </v-layer>\r\n                </v-stage>\r\n            </div>\r\n          </div>\r\n\r\n      </b-col>\r\n      <b-col sm="9">\r\n        {{msg}}{{hover}}\r\n        <div class="row no-gutters border-top p-1">\r\n          <div v-for="(x,i) in listData" :key="i" class="mb-1 mr-1 col-sm-2">\r\n            <div :class=" (i==hover) ? \'border border-primary\' : \'\' " style="position:relative" @mouseover=" hover=i " @mouseout=" hover=-1 " >\r\n              <img :src=" x.src " @click="onView(x.data)" class="img-thumbnail" >\r\n              <button @click="onDelData(i)" class="m-1" style="position:absolute; bottom:0; right: 0;">Del</button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n      </b-col>\r\n    </b-row>\r\n  </div>\r\n</template>\r\n<script>\r\nvar sceneWidth = 1500;\r\nvar sceneHeight = 1000;\r\nvar stage=null;\r\nvar layer=null;\r\nexport default {\r\n  name: \'Tpl\',\r\n  components: {\r\n  },\r\n  computed: {\r\n  \ttest () {\r\n    \treturn \'hello\'\r\n    },\r\n  },\r\n  data(){\r\n    return{\r\n        msg:"hello",\r\n        configKonva: {\r\n          width: sceneWidth,\r\n          height: sceneHeight\r\n        },\r\n        configCircle: {\r\n          x: sceneWidth/2,\r\n          y: sceneHeight/2,\r\n          radius: 90,\r\n          fill: "yellow",\r\n          stroke: "black",\r\n          strokeWidth: 5,\r\n          draggable:true,\r\n          visible:false,\r\n        },\r\n        count:0,\r\n        p:{},\r\n        arPoint:[],\r\n        Sel:[],\r\n        arSel:[],\r\n        unLink:false,\r\n        listData:[],\r\n        hover:-1,\r\n    }\r\n  },\r\n  mounted(){\r\n    this.$nextTick(function(){\r\n      layer=this.$refs.layer.getNode();\r\n      stage=this.$refs.stage.getNode();\r\n      window.addEventListener("resize", this.fitStageIntoParentContainer);\r\n      this.fitStageIntoParentContainer();\r\n    })\r\n  },\r\n  created(){\r\n  },\r\n  methods:{\r\n    onDelData(i){\r\n      this.listData.splice(i,1);\r\n    },\r\n    onView(data){\r\n      this.load( JSON.parse(JSON.stringify(data)));//<--------------------------------------cáº©n tháº­n Khi view data\r\n    },\r\n    onSave(){\r\n      let src = stage.toDataURL();\r\n      let data={ "arPoint": this.arPoint, "arSel": this.arSel, "count": this.count };\r\n      this.listData.push({src:src,data:JSON.parse(JSON.stringify(data))})//<--------------------cáº©n tháº­n Khi save data\r\n    },\r\n    load(data){\r\n      this.reset();\r\n      this.count=data.count;\r\n      this.arPoint=data.arPoint;\r\n      this.arSel=data.arSel;\r\n      this.arPoint.forEach((x,i)=>{\r\n        let ball=this.createBall(x.x,x.y,60,\'myball\',x.id.toString());\r\n        layer.add(ball);\r\n      })\r\n      this.arSel.forEach((x,i)=>{\r\n        let line=this.createLine(\'myline\');\r\n        layer.add(line);\r\n      })\r\n      this.draw(); \r\n    },\r\n    onLoad(){\r\n      let data={ "arPoint": [ { "id": 0, "x": 577, "y": 129 }, { "id": 1, "x": 452, "y": 273 }, { "id": 2, "x": 721, "y": 304 }, { "id": 3, "x": 352, "y": 498 }, { "id": 4, "x": 552, "y": 516 } ], "arSel": [ [ 0, 1 ], [ 0, 2 ], [ 1, 3 ], [ 1, 4 ] ], "count": 5 };\r\n      this.load(data);\r\n    },\r\n    reset(){\r\n      this.count=0;\r\n      this.arPoint.forEach((x,i)=>{\r\n        layer.find(\'.myball\')[0].destroy();\r\n      })\r\n      this.arPoint=[];\r\n      this.arSel.forEach((x,i)=>{\r\n        layer.find(\'.myline\')[0].destroy();\r\n      })\r\n      this.arSel=[];\r\n    },\r\n    onReset(){\r\n      this.reset();\r\n      this.draw();\r\n    },\r\n    onDel(){\r\n      let id=this.Sel[0];\r\n      let arLink=[];\r\n      let arSel=[];\r\n      this.arSel.forEach((x,i)=>{\r\n        if( x.includes(id) ){\r\n          arLink.push(x);\r\n        }else{\r\n          arSel.push(x);\r\n        }\r\n      })\r\n      //del line\r\n      arLink.forEach((y,j)=>{\r\n        layer.find(\'.myline\')[0].destroy();\r\n      });\r\n      //del line data\r\n      this.arSel=arSel;\r\n      //xoa point\r\n      layer.find(`#${id}`)[0].destroy();\r\n      //xoat point data\r\n      let index=this.arPoint.findIndex(x=>x.id==id);\r\n      this.arPoint.splice(index,1);\r\n      this.draw();\r\n    },\r\n    onUnlink(id1,id2){\r\n      let delLine=false;\r\n      let arRemain=[];\r\n      this.arSel.forEach((x,i)=>{\r\n        if(x.includes(id1) && x.includes(id2)){\r\n          delLine=true;\r\n        }else{\r\n          arRemain.push(x);\r\n        }\r\n      })\r\n      if(delLine==true){\r\n        layer.find(\'.myline\')[0].destroy();\r\n      }\r\n      this.arSel=arRemain;\r\n      this.unLink=false;\r\n      this.draw();\r\n    },\r\n    chkPairExist(id1,id2){\r\n      let dup=false;\r\n      this.arSel.forEach((x,i)=>{\r\n        if(x.includes(id1) && x.includes(id2) ){\r\n          dup=true;\r\n        }\r\n      })\r\n      return dup;\r\n    },\r\n    onLink(){\r\n      let id1=this.Sel[0];\r\n      let id2=this.Sel[1];\r\n      let dup2=this.chkPairExist(id1,id2);\r\n      if(dup2==true){\r\n        this.onUnlink(id1,id2);\r\n        return;\r\n      }\r\n      this.arSel.push(this.Sel);\r\n      let line=this.createLine(\'myline\');\r\n      layer.add(line);\r\n      this.drawLine();\r\n      let lBall=layer.find(".myball");\r\n      lBall.forEach((x,i)=>{\r\n        this.drawBall(x);\r\n      })\r\n      this.Sel=this.getSel();\r\n      this.draw();\r\n    },\r\n    drawLine(){\r\n      let lLine=layer.find(".myline");\r\n      lLine.forEach((x,i)=>{\r\n        let id1=this.arSel[i][0];\r\n        let id2=this.arSel[i][1];\r\n        let s1=layer.find(`#${id1}`)[0];\r\n        let s2=layer.find(`#${id2}`)[0];\r\n        let p1={x:s1.x(),y:s1.y()}\r\n        let p2={x:s2.x(),y:s2.y()}\r\n        x.points([p1.x,p1.y,p2.x,p2.y]);\r\n        x.moveToBottom();\r\n      })\r\n    },\r\n    draw(){\r\n      this.drawLine();\r\n      this.msg={\r\n        // p:this.p,\r\n        // Sel:this.Sel,\r\n        // lBall:layer.find(".myball").length,\r\n        // lLine:layer.find(".myline").length,\r\n        arPoint:this.arPoint,\r\n        arSel:this.arSel,\r\n        count:this.count,\r\n      }\r\n    },\r\n    createLine(name){\r\n      let line=this.$refs.line.getNode().clone();\r\n      line.visible(true);\r\n      line.name(name);\r\n      return line;\r\n    },\r\n    drawBall(ball){\r\n      let color=ball.fill();\r\n      let colorFill;\r\n      let colorText;\r\n      if(color==\'blue\'){\r\n        colorFill=\'yellow\';\r\n        colorText=\'red\';\r\n        ball.fill(colorFill);\r\n        ball.setAttr(\'textcolor\',colorText);\r\n      }\r\n    },\r\n    createBall(x,y,r,name,id){\r\n      let that=this;\r\n      let ball=this.$refs.ball.getNode().clone();\r\n      ball.visible(true);\r\n      ball.x(x);\r\n      ball.y(y);\r\n      ball.setAttr(\'r\',r);\r\n      ball.fill("yellow");\r\n      ball.stroke(\'black\');\r\n      ball.name(name);\r\n      ball.id(id);\r\n      ball.setAttr("text",id);\r\n      ball.on("click",function(e){\r\n        let color=e.target.fill();\r\n        let colorFill;\r\n        let colorText;\r\n        if(color==\'blue\'){\r\n          colorFill=\'yellow\';\r\n          colorText=\'red\';\r\n        }else{\r\n          colorFill=\'blue\';\r\n          colorText=\'white\';\r\n        }\r\n        e.target.fill(colorFill);\r\n        e.target.setAttr(\'textcolor\',colorText);\r\n        that.Sel=that.getSel();\r\n\r\n        that.unLink=false;\r\n        if(that.Sel.length==2){\r\n          let idd1=that.Sel[0];\r\n          let idd2=that.Sel[1];\r\n          if(that.chkPairExist(idd1,idd2)==true){\r\n            that.unLink=true;\r\n          }\r\n        }\r\n\r\n\r\n\r\n        that.draw();\r\n\r\n      });\r\n      ball.on("dragend",function(e){\r\n      });\r\n      ball.on("dragmove",function(e){\r\n        let p={\r\n          id:e.target.id(),\r\n          x: Math.floor (e.target.x()),\r\n          y: Math.floor (e.target.y())\r\n        }\r\n        that.p=p;\r\n        let index=that.arPoint.findIndex(x=>x.id==p.id);\r\n        that.arPoint[index]=p;\r\n        that.draw();\r\n      });\r\n      return ball;\r\n    },\r\n    getSel(){\r\n      let kq=[];\r\n      let l=layer.find(".myball");\r\n      l.forEach((x,i)=>{\r\n        if(x.fill()==\'blue\'){\r\n          kq.push( parseInt (x.id()))\r\n        }\r\n      })\r\n      return kq;\r\n    },\r\n    onStageClick(e){\r\n      let chk=e.target.name();\r\n      if(chk==\'myball\'){\r\n        return;\r\n      }\r\n      let p=this.myGetMouse();\r\n      let ball=this.createBall(p.x,p.y,60,"myball",this.count.toString());\r\n      this.arPoint.push({id:this.count,x:p.x,y:p.y});\r\n      this.count++;\r\n      layer.add(ball);\r\n      this.draw();\r\n    },\r\n    onStageMouseMove(e){\r\n    },\r\n    getListRect(){ return layer.find(".myrect") },\r\n    getListLine(){ return layer.find(".myline") },\r\n    getListBall(){ return layer.find(".myball") },\r\n    myGetMouse() {\r\n      let scale=stage.scale().x;\r\n      var mousePos = stage.getPointerPosition();\r\n      var x = mousePos.x;\r\n      var y = mousePos.y;\r\n      var xx = Math.round(x / scale);\r\n      var yy = Math.round(y / scale);\r\n      return { x: xx, y: yy };\r\n    },\r\n    fitStageIntoParentContainer() {\r\n      var container = document.querySelector(\'#stage-parent\');\r\n      var containerWidth = container.offsetWidth;\r\n      var scale = containerWidth / sceneWidth;\r\n      stage.width(sceneWidth * scale);\r\n      stage.height(sceneHeight * scale);\r\n      stage.scale({ x: scale, y: scale });\r\n      this.configKonva.width = sceneWidth * scale;\r\n      this.configKonva.height = sceneHeight * scale;\r\n    },\r\n  }\r\n}\r\n<\/script>\r\n<style scoped>\r\n\r\ndiv.relative {\r\n  position: relative;\r\n  border: 3px solid #73AD21;\r\n} \r\n\r\ndiv.absolute {\r\n  position: absolute;\r\n  top: 80px;\r\n  right: 0;\r\n  border: 3px solid #73AD21;\r\n}\r\n\r\n\r\n</style>\r\n'}}]);
//# sourceMappingURL=6552-legacy.f67ee646.js.map