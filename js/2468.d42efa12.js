"use strict";(self["webpackChunkvue_start_1"]=self["webpackChunkvue_start_1"]||[]).push([[2468],{42468:function(e,t,r){r.r(t),r.d(t,{default:function(){return f}});var n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("raw-loader",{attrs:{mytxt:r(81555).Z}}),n("h1",[e._v("This is KonvaVue")]),n("b-row",[n("b-col",{staticClass:"border-right",attrs:{sm:"3"}},[n("div",{staticClass:"mb-1"}),n("div",{attrs:{id:"stage-parent"}},[n("div",{staticClass:"border",attrs:{id:"container"}},[n("v-stage",{ref:"stage",attrs:{config:e.configKonva},on:{click:e.onStageClick,mousemove:e.onStageMouseMove,mouseenter:e.onStageMouseenter,mouseleave:e.onStageMouseleave}},[n("v-layer",{ref:"layer"},[n("v-circle",{ref:"circle",attrs:{config:e.configCircle}}),n("v-rect",{ref:"rect",attrs:{config:{x:100,y:100,width:100,height:100,fill:"yellow",stroke:"blue",strokeWidth:5,draggable:!0,visible:!1}}}),n("v-line",{ref:"line",attrs:{config:{points:[100,100,400,200],stroke:"gray",strokeWidth:5,lineCap:"round",lineJoin:"round",draggable:!0,visible:!1}}}),n("v-shape",{ref:"nice",attrs:{config:{sceneFunc:function(e,t){var r=-20,n=-50;e.beginPath(),e.moveTo(r+20,n+50),e.lineTo(r+220,n+80),e.quadraticCurveTo(r+150,n+100,r+260,n+170),e.closePath(),e.fillStrokeShape(t)},fill:"#00D2FF",stroke:"black",strokeWidth:4,visible:!0,draggable:!0,visible:!1}}}),n("v-shape",{ref:"ball",attrs:{config:{x:150,y:150,r:90,text:"1",fontSize:50,fill:"aqua",stroke:"black",textcolor:"red",strokeWidth:1,draggable:!0,sel:!1,visible:!1,sceneFunc:function(e,t){var r=t.getAttr("fontSize");e.beginPath(),e.arc(0,0,t.getAttr("r"),0,2*Math.PI),e.fillStrokeShape(t);var n=t.getAttr("textcolor");e.fillStyle=n,e.textBaseline="middle",e.textAlign="center",e.font=r+"px verdana",e.fillText(""+t.getAttr("text"),0,0)}}}}),n("v-shape",{ref:"board",attrs:{config:{x:50,y:50,width:300,height:100,text:"Thức 101",fontSize:60,fill:"yellow",stroke:"red",strokeWidth:1,draggable:!0,visible:!1,sceneFunc:function(e,t){var r=t.getAttr("fontSize");e.beginPath(),e.rect(0,0,t.getAttr("width"),t.getAttr("height")),e.fillStrokeShape(t),e.fillStyle="red",e.textBaseline="middle",e.textAlign="center",e.font=r+"px Times New Roman",e.fillText(""+t.getAttr("text"),t.getAttr("width")/2,t.getAttr("height")/2)}}}})],1)],1)],1)])]),n("b-col",{attrs:{sm:"9"}},[e._v(" "+e._s(e.msg)),n("br")])],1)],1)},i=[],a=1500,o=1e3,s=null,l=null,c={name:"Tpl",components:{},computed:{test(){return"hello"}},data(){return{msg:"hello",configKonva:{width:a,height:o},configCircle:{x:a/2,y:o/2,radius:90,fill:"yellow",stroke:"black",strokeWidth:5,draggable:!0,visible:!0},count:0,p:{},arPoint:[],Sel:[],arSel:[],unLink:!1,listData:[],hover:-1}},mounted(){this.$nextTick((function(){l=this.$refs.layer.getNode(),s=this.$refs.stage.getNode(),window.addEventListener("resize",this.fitStageIntoParentContainer),this.fitStageIntoParentContainer();let e=this.createAnimate();e.start()}))},created(){},methods:{createRect(e,t){let r=this.$refs.rect.getNode().clone();return r.visible(!0),r.x(e-r.width()/2),r.y(t-r.height()/2),r.name("myrect"),r},createAnimate(){let e=this.$refs.circle.getNode(),t=this;var r=new Konva.Animation((function(r){t.getListRect().forEach(((r,n)=>{r.x(),r.width(),r.y(),r.height();t.rotateAroundPoint(r,2,{x:e.x(),y:e.y()});let i=t.myGetClientRect(r),a={x:i.x+i.width/2,y:i.y+i.height/2};t.rotateAroundPoint(r,5,a)}))}),l);return r},onStageClick(e){let t=this.myGetMouse(),r=this.createRect(t.x,t.y);l.add(r)},onStageMouseMove(e){},onStageMouseenter(e){},onStageMouseleave(e){},getListRect(){return l.find(".myrect")},getListLine(){return l.find(".myline")},getListBall(){return l.find(".myball")},getBallById(e){return l.find(`#${e}`)[0]},rotateAroundPoint(e,t,r){let n=t*Math.PI/180;const i=r.x+(e.x()-r.x)*Math.cos(n)-(e.y()-r.y)*Math.sin(n),a=r.y+(e.x()-r.x)*Math.sin(n)+(e.y()-r.y)*Math.cos(n);e.position({x:i,y:a}),e.rotation(e.rotation()+t)},myGetClientRect(e){let t=s.scale().x,r=e.getClientRect();return r.x=r.x/t,r.y=r.y/t,r.width=r.width/t,r.height=r.height/t,r},myGetMouse(){let e=s.scale().x;var t=s.getPointerPosition(),r=t.x,n=t.y,i=Math.round(r/e),a=Math.round(n/e);return{x:i,y:a}},fitStageIntoParentContainer(){var e=document.querySelector("#stage-parent"),t=e.offsetWidth,r=t/a;s.width(a*r),s.height(o*r),s.scale({x:r,y:r}),this.configKonva.width=a*r,this.configKonva.height=o*r}}},h=c,g=r(1001),d=(0,g.Z)(h,n,i,!1,null,"79757733",null),f=d.exports},81555:function(e,t){t["Z"]='<template>\r\n  <div>\r\n    <raw-loader :mytxt=" require(\'!raw-loader!./KonvaVueRotate.vue\').default "></raw-loader> \r\n    <h1>This is KonvaVue</h1>\r\n    <b-row>\r\n      <b-col sm="3" class="border-right">\r\n          <div class="mb-1">\r\n          </div>\r\n          <div id="stage-parent">\r\n            <div id="container" class="border">\r\n                <v-stage ref="stage"\r\n                    @click="onStageClick"\r\n                    @mousemove="onStageMouseMove" \r\n                    @mouseenter="onStageMouseenter"\r\n                    @mouseleave="onStageMouseleave"\r\n                    :config="configKonva" >\r\n                    <v-layer ref="layer">\r\n                        <v-circle ref="circle" :config="configCircle"></v-circle>\r\n                        <v-rect ref="rect" \r\n                            :config="{\r\n                                x: 100,\r\n                                y: 100,\r\n                                width: 100,\r\n                                height: 100,\r\n                                fill: \'yellow\',\r\n                                stroke:\'blue\',\r\n                                strokeWidth:5,\r\n                                //shadowBlur: 10,\r\n                                draggable:true,\r\n                                visible:false\r\n                            }"\r\n                        />\r\n                        <v-line ref="line" :config="{\r\n                          points: [100,100,400,200],\r\n                          stroke: \'gray\',\r\n                          strokeWidth: 5,\r\n                          lineCap: \'round\',\r\n                          lineJoin: \'round\',\r\n                          draggable:true,\r\n                          visible: false\r\n                        }"></v-line>\r\n                        <v-shape ref="nice"\r\n                          :config="{\r\n                            sceneFunc: function(context, shape) {\r\n                              let x=-20;\r\n                              let y=-50;\r\n                              context.beginPath();\r\n                              context.moveTo(x+20, y+50);\r\n                              context.lineTo(x+220, y+80);\r\n                              context.quadraticCurveTo(x+150, y+100, x+260, y+170);\r\n                              context.closePath();\r\n                              context.fillStrokeShape(shape);\r\n                            },\r\n                            fill: \'#00D2FF\',\r\n                            stroke: \'black\',\r\n                            strokeWidth: 4,\r\n                            visible: true,\r\n                            draggable:true,\r\n                            visible:false,\r\n                          }"\r\n                        />\r\n                        <v-shape ref="ball"\r\n                          :config="{\r\n                            x:150,\r\n                            y:150,\r\n                            r:90,\r\n                            text:\'1\',\r\n                            fontSize:50,\r\n                            fill: \'aqua\',\r\n                            stroke: \'black\',\r\n                            textcolor:\'red\',\r\n                            strokeWidth: 1,\r\n                            draggable:true,  \r\n                            sel:false,      \r\n                            visible:false,\r\n                            sceneFunc: function (context, shape) {\r\n                              let fontSize=shape.getAttr(\'fontSize\');//40;\r\n                              context.beginPath();\r\n                              context.arc(0, 0, shape.getAttr(\'r\'), 0, 2 * Math.PI);\r\n                              context.fillStrokeShape(shape);\r\n                              let textcolor=shape.getAttr(\'textcolor\');\r\n                              context.fillStyle=textcolor;//\'white\';\r\n                              context.textBaseline = \'middle\'; \r\n                              context.textAlign = \'center\';\r\n                              context.font=`${fontSize}px verdana`;//verdana//Times New Roman\r\n                              context.fillText(`${shape.getAttr(\'text\')}`, 0,0);\r\n\r\n                            }\r\n                          }"\r\n                        />\r\n                        <v-shape ref="board" :config="{\r\n                          x:50,\r\n                          y:50,\r\n                          width:300,\r\n                          height:100,\r\n                          text:\'Thức 101\',\r\n                          fontSize:60,\r\n                          fill: \'yellow\',\r\n                          stroke: \'red\',\r\n                          strokeWidth: 1,\r\n                          draggable:true, \r\n                          visible:false,       \r\n                          sceneFunc: function (context, shape) {\r\n                            let fontSize=shape.getAttr(\'fontSize\');\r\n                            context.beginPath();\r\n                            context.rect(0, 0, shape.getAttr(\'width\'), shape.getAttr(\'height\'));\r\n                            context.fillStrokeShape(shape);\r\n                            context.fillStyle=\'red\';\r\n                            context.textBaseline = \'middle\'; \r\n                            context.textAlign = \'center\';\r\n                            context.font=`${fontSize}px Times New Roman`;\r\n                            context.fillText(`${shape.getAttr(\'text\')}`, shape.getAttr(\'width\')/2,shape.getAttr(\'height\')/2);\r\n                          }\r\n                        }">\r\n                        </v-shape>\r\n                    </v-layer>\r\n                </v-stage>\r\n            </div>\r\n          </div>\r\n\r\n      </b-col>\r\n      <b-col sm="9">\r\n        {{msg}}<br>\r\n      </b-col>\r\n    </b-row>\r\n  </div>\r\n</template>\r\n<script>\r\nvar sceneWidth = 1500;\r\nvar sceneHeight = 1000;\r\nvar stage=null;\r\nvar layer=null;\r\nexport default {\r\n  name: \'Tpl\',\r\n  components: {\r\n  },\r\n  computed: {\r\n  \ttest () {\r\n    \treturn \'hello\'\r\n    },\r\n  },\r\n  data(){\r\n    return{\r\n        msg:"hello",\r\n        configKonva: {\r\n          width: sceneWidth,\r\n          height: sceneHeight\r\n        },\r\n        configCircle: {\r\n          x: sceneWidth/2,\r\n          y: sceneHeight/2,\r\n          radius: 90,\r\n          fill: "yellow",\r\n          stroke: "black",\r\n          strokeWidth: 5,\r\n          draggable:true,\r\n          visible:true,\r\n        },\r\n        count:0,\r\n        p:{},\r\n\r\n\r\n\r\n        \r\n        arPoint:[],\r\n        Sel:[],\r\n        arSel:[],\r\n        unLink:false,\r\n        listData:[],\r\n        hover:-1,\r\n    }\r\n  },\r\n  mounted(){\r\n    this.$nextTick(function(){\r\n      layer=this.$refs.layer.getNode();\r\n      stage=this.$refs.stage.getNode();\r\n      window.addEventListener("resize", this.fitStageIntoParentContainer);\r\n      this.fitStageIntoParentContainer();\r\n      let ami=this.createAnimate();\r\n      ami.start();\r\n    })\r\n  },\r\n  created(){\r\n  },\r\n  methods:{\r\n    createRect(x,y){\r\n      let rect=this.$refs.rect.getNode().clone();\r\n      rect.visible(true);\r\n      rect.x(x-rect.width()/2);\r\n      rect.y(y-rect.height()/2);\r\n      rect.name("myrect");\r\n      return rect;\r\n    },\r\n    createAnimate(){\r\n      let c=this.$refs.circle.getNode();\r\n      let that=this;\r\n      var anim = new Konva.Animation(function (frame) {\r\n        that.getListRect().forEach((x,i)=>{\r\n          let p={\r\n            x:x.x()+x.width()/2,\r\n            y:x.y()+x.height()/2\r\n          }\r\n          //that.rotateAroundPoint(x,2,p);\r\n          //x.rotation(3);\r\n          that.rotateAroundPoint(x,2,{x:c.x(),y:c.y()});\r\n          let p2=that.myGetClientRect(x);\r\n          let p3={x:p2.x+p2.width/2,y:p2.y+p2.height/2}\r\n          that.rotateAroundPoint(x,5,p3);\r\n\r\n        })\r\n      }, layer);\r\n      return anim;\r\n    },\r\n    onStageClick(e){\r\n      let p=this.myGetMouse();\r\n      let rect=this.createRect(p.x,p.y);\r\n      layer.add(rect);\r\n    },\r\n    onStageMouseMove(e){\r\n    },\r\n    onStageMouseenter(e){\r\n    },\r\n    onStageMouseleave(e){\r\n    },\r\n    getListRect(){ return layer.find(".myrect") },\r\n    getListLine(){ return layer.find(".myline") },\r\n    getListBall(){ return layer.find(".myball") },\r\n    getBallById(id){ return layer.find(`#${id}`)[0] },\r\n    rotateAroundPoint(shape, angleDegrees, point) {\r\n        let angleRadians = angleDegrees * Math.PI / 180; // sin + cos require radians\r\n        const x =\r\n          point.x +\r\n          (shape.x() - point.x) * Math.cos(angleRadians) -\r\n          (shape.y() - point.y) * Math.sin(angleRadians);\r\n        const y =\r\n          point.y +\r\n          (shape.x() - point.x) * Math.sin(angleRadians) +\r\n          (shape.y() - point.y) * Math.cos(angleRadians);\r\n        shape.position({x: x, y: y});  // move the rotated shape in relation to the rotation point.\r\n        shape.rotation(shape.rotation() + angleDegrees); // rotate the shape in place around its natural rotation point\r\n    },\r\n    myGetClientRect(shape){\r\n        let scale2=stage.scale().x;\r\n        let r=shape.getClientRect();\r\n        r.x=r.x/scale2;\r\n        r.y=r.y/scale2;\r\n        r.width=r.width/scale2;\r\n        r.height=r.height/scale2;\r\n        return r;\r\n    },\r\n\r\n    myGetMouse() {\r\n      let scale=stage.scale().x;\r\n      var mousePos = stage.getPointerPosition();\r\n      var x = mousePos.x;\r\n      var y = mousePos.y;\r\n      var xx = Math.round(x / scale);\r\n      var yy = Math.round(y / scale);\r\n      return { x: xx, y: yy };\r\n    },\r\n    fitStageIntoParentContainer() {\r\n      var container = document.querySelector(\'#stage-parent\');\r\n      var containerWidth = container.offsetWidth;\r\n      var scale = containerWidth / sceneWidth;\r\n      stage.width(sceneWidth * scale);\r\n      stage.height(sceneHeight * scale);\r\n      stage.scale({ x: scale, y: scale });\r\n      this.configKonva.width = sceneWidth * scale;\r\n      this.configKonva.height = sceneHeight * scale;\r\n    },\r\n  }\r\n}\r\n<\/script>\r\n<style scoped>\r\n</style>\r\n'}}]);
//# sourceMappingURL=2468.d42efa12.js.map